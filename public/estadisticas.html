<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Estad√≠sticas - Juegos Ol√≠mpicos Mart√≠nez</title>
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- Incluir funciones de logros -->
  <script src="achievements.js"></script>
  <script src="estadisticas.js" defer></script>
  <style>
/* Estilos para el historial reciente */
    .history-item {
      display: flex;
      align-items: center;
      padding: 12px 15px;
      margin-bottom: 10px;
      border-radius: 8px;
      transition: all 0.2s ease;
      border-left: 4px solid #6c757d;
    }
    
    .history-item.gold {
      background-color: #fff3cc; /* Amarillo muy claro para oro */
      border-left-color: #FFD700; /* Dorado */
    }
    
    .history-item.silver {
      background-color: #e4e4e4; /* Gris muy claro para plata */
      border-left-color: #C0C0C0; /* Plateado */
    }
    
    .history-item.bronze {
      background-color: #ffe7c0; /* Naranja muy claro para bronce */
      border-left-color: #CD7F32; /* Bronce */
    }
    
    .history-item:hover {
      transform: translateX(5px);
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    .history-icon {
      font-size: 1.5rem;
      margin-right: 15px;
      width: 32px;
      text-align: center;
    }
    
    .history-details {
      flex: 1;
    }
    
    .history-title {
      font-weight: 600;
      margin: 0 0 4px 0;
      color: #343a40;
    }
    
    .history-time {
      font-size: 0.85rem;
      color: #6c757d;
      margin: 0;
    }
    
    .history-medal {
      display: inline-block;
      width: 24px;
      text-align: center;
      margin-right: 5px;
    }
    
    .history-loading {
      text-align: center;
      padding: 20px;
      color: #6c757d;
      font-style: italic;
    }
    
    .no-history {
      text-align: center;
      padding: 30px 20px;
      color: #6c757d;
    }
    
    /* Estilos para el bot√≥n de reiniciar contadores */
    #btnReiniciarContadores, #btnReiniciarHistorial {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 0.6rem 1.2rem;
      font-size: 0.95rem;
      font-weight: 600;
      color: white;
      background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%);
      border: none;
      border-radius: 50px;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(33, 150, 243, 0.3);
      margin-left: 15px;
    }
    
    #btnReiniciarContadores i, #btnReiniciarHistorial i {
      font-size: 1.1em;
      margin-right: 6px;
    }
    
    #btnReiniciarContadores:hover, #btnReiniciarHistorial:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(33, 150, 243, 0.4);
      background: linear-gradient(135deg, #1e88e5 0%, #1565c0 100%);
    }
    
    .achievements-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }
    
    :root {
      /* Colores para logros */
      --logro-oro-fondo: #fff9c4;
      --logro-oro-borde: #ffd700;
      --logro-plata-fondo: #e6e6e6;
      --logro-plata-borde: #acacac;
      --logro-bronce-fondo: #ffecb3;
      --logro-bronce-borde: #cd7f32;
      --logro-verde-fondo: #e8f5e9;
      --logro-verde-borde: #4caf50;
      --logro-azul-fondo: #e3f2fd;
      --logro-azul-borde: #2196f3;
      --logro-morado-fondo: #f3e5f5;
      --logro-morado-borde: #9c27b0;
    }

    .stats-container {
      max-width: 1000px;
      margin: 0 auto;
      padding: 20px;
    }
    .stat-card {
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    
    /* Estilos para los logros */
    .logro {
      display: flex;
      align-items: center;
      background: var(--logro-oro-fondo);
      border-left: 4px solid var(--logro-oro-borde);
      padding: 1rem;
      margin-bottom: 1rem;
      border-radius: 10px;
      transition: all 0.3s ease;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      cursor: pointer;
    }
    
    .logro:hover {
      transform: translateY(-3px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }
    
    .logro-icono {
      font-size: 2rem;
      margin-right: 1rem;
      min-width: 50px;
      text-align: center;
      transition: all 0.3s ease;
      display: inline-block;
    }
    
    .logro:hover .logro-icono {
      transform: scale(1.2) rotate(5deg);
    }
    
    /* Specific emoji animations */
    .logro[data-emoji*="üé©"]:hover .logro-icono {
      animation: spin 1s ease;
    }
    
    .logro[data-emoji*="üèÜ"]:hover .logro-icono {
      animation: bounce 0.5s ease infinite alternate;
    }
    
    .logro[data-emoji*="üëë"]:hover .logro-icono {
      animation: tilt 0.5s ease infinite alternate;
    }
    
    .logro[data-emoji*="üé≠"]:hover .logro-icono {
      animation: shake 0.5s ease infinite;
    }
    
    @keyframes spin {
      from { transform: rotate(0deg) scale(1.2); }
      to { transform: rotate(360deg) scale(1.2); }
    }
    
    @keyframes bounce {
      from { transform: translateY(0) scale(1.2); }
      to { transform: translateY(-5px) scale(1.2); }
    }
    
    @keyframes tilt {
      from { transform: rotate(-10deg) scale(1.2); }
      to { transform: rotate(10deg) scale(1.2); }
    }
    
    @keyframes shake {
      0% { transform: rotate(-5deg) scale(1.2); }
      50% { transform: rotate(5deg) scale(1.2); }
      100% { transform: rotate(-5deg) scale(1.2); }
    }
    
    .logro-contenido {
      flex: 1;
    }
    
    .logro h3 {
      margin: 0 0 0.5rem 0;
      color: #343a40;
    }
    
    .logro p {
      margin: 0 0 0.5rem 0;
      color: #6c757d;
    }
    
    .medal-count {
      display: flex;
      gap: 1rem;
      margin-top: 0.5rem;
    }
    
    .medal-count span {
      display: flex;
      align-items: center;
      gap: 0.25rem;
      font-weight: 600;
    }
    
    .gold { color: #ffc107; }
    .silver { color: #c0c0c0; }
    .bronze { color: #cd7f32; }
    
    .no-logros {
      text-align: center;
      padding: 2rem 1rem;
      color: #6c757d;
    }
    .stat-card h2 {
      color: var(--blue);
      margin: 0;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .achievements-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
      padding-bottom: 0.75rem;
      border-bottom: 2px solid #eee;
    }
    
    .btn-secondary {
      background: #f8f9fa;
      color: #495057;
      border: 1px solid #dee2e6;
      border-radius: 50px;
      padding: 0.5rem 1rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.9rem;
      transition: all 0.2s ease;
    }
    
    .btn-secondary:hover {
      background: #e9ecef;
      transform: translateY(-1px);
    }
    
    .btn-secondary i {
      font-size: 0.9em;
    }
    .chart-container {
      position: relative;
      height: 300px;
      margin: 20px 0;
    }
    .medal-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      margin: 1.5rem 0;
    }
    .medal-stat {
      text-align: center;
      padding: 1.5rem 1rem;
      border-radius: 12px;
      color: white;
      font-weight: bold;
      display: flex;
      flex-direction: column;
      align-items: center;
      transition: all 0.3s ease;
      cursor: pointer;
      position: relative;
      overflow: hidden;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }
    
    .medal-stat::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: 0.5s;
    }
    
    .medal-stat:hover::before {
      left: 100%;
    }
    
    .medal-stat:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 25px rgba(0,0,0,0.15);
    }
    
    .medal-stat.gold { 
      background: linear-gradient(135deg, #FFD700, #FFA500);
    }
    .medal-stat.silver { 
      background: linear-gradient(135deg, #C0C0C0, #A0A0A0);
    }
    .medal-stat.bronze { 
      background: linear-gradient(135deg, #CD7F32, #8B4513);
    }
    
    .medal-stat .count {
      font-size: 2.5rem;
      margin: 0.5rem 0;
      text-shadow: 0 2px 4px rgba(0,0,0,0.2);
      position: relative;
      display: inline-block;
      transition: transform 0.3s ease, color 0.3s ease;
    }
    
    .medal-stat .count.counting {
      animation: pulse 0.5s ease;
      color: #fff;
    }
    
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.2); }
      100% { transform: scale(1); }
    }
    
    .medal-stat .count::after {
      content: '';
      position: absolute;
      bottom: -5px;
      left: 50%;
      transform: translateX(-50%);
      width: 50px;
      height: 2px;
      background: rgba(255,255,255,0.7);
      transition: all 0.3s ease;
    }
    
    .medal-stat:hover .count::after {
      width: 70px;
      background: white;
    }
    
    .medal-stat span:first-child {
      font-size: 1.2rem;
      margin-bottom: 0.5rem;
      text-transform: uppercase;
      letter-spacing: 1px;
      text-shadow: 0 1px 2px rgba(0,0,0,0.2);
    }
    
    .medal-stat span:last-child {
      font-size: 0.9rem;
      opacity: 0.9;
      margin-top: 0.3rem;
    }
    .top-moments {
      list-style: none;
      padding: 0;
    }
    .moment {
      background: #f8f9fa;
      padding: 1rem;
      margin-bottom: 0.5rem;
      border-radius: 5px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .moment .medal {
      padding: 0.2rem 0.5rem;
      border-radius: 3px;
      color: white;
      font-size: 0.8rem;
      margin-left: 0.5rem;
    }
    .moment .medal.gold { background: #FFD700; }
    .moment .medal.silver { background: #C0C0C0; }
    .moment .medal.bronze { background: #CD7F32; }
    .btn-back {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      margin: 0 0 2rem 0;
      padding: 0.8rem 1.8rem;
      background: linear-gradient(135deg, var(--blue) 0%, #1e88e5 100%);
      color: white;
      text-decoration: none;
      border-radius: 50px;
      font-weight: 600;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(41, 182, 246, 0.3);
      border: none;
      font-size: 1.05rem;
    }
    
    .btn-back:hover {
      background: linear-gradient(135deg, #1e88e5 0%, #1565c0 100%);
      transform: translateY(-2px) scale(1.02);
      box-shadow: 0 6px 20px rgba(41, 182, 246, 0.4);
    }
    
    /* Estilos para el selector de jugador */
    .player-selector-container {
      position: relative;
      width: 100%;
      max-width: 300px;
      margin-left: auto;
    }
    
    .player-selector {
      width: 100%;
      padding: 0.8rem 1.2rem 0.8rem 3rem;
      border-radius: 30px;
      border: 2px solid #e0e0e0;
      font-size: 1rem;
      font-weight: 500;
      background-color: white;
      cursor: pointer;
      transition: all 0.3s ease;
      -webkit-appearance: none;
      -moz-appearance: none;
      appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='%23666' viewBox='0 0 16 16'%3E%3Cpath d='M7.247 11.14L2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 1rem center;
      background-size: 12px;
      padding-right: 2.5rem;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    .player-selector:hover {
      border-color: #29b6f6;
      box-shadow: 0 4px 12px rgba(41, 182, 246, 0.2);
    }
    
    .player-selector:focus {
      outline: none;
      border-color: #29b6f6;
      box-shadow: 0 0 0 3px rgba(41, 182, 246, 0.3);
    }
    
    .player-selector option {
      padding: 0.5rem 1rem;
      font-size: 0.95rem;
    }
    
    .player-selector option:first-child {
      color: #999;
    }
    
    .player-selector-icon {
      position: absolute;
      left: 1rem;
      top: 50%;
      transform: translateY(-50%);
      color: #29b6f6;
      pointer-events: none;
    }
    
    /* Estilos para la secci√≥n de perfil */
    .player-profile-section {
      margin-top: 1.5rem;
    }
    
    .player-info {
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      margin-bottom: 1.5rem;
      padding: 1.5rem 1.5rem 1rem;
      background: linear-gradient(135deg, #c4e5ff 0%, #e6f4ff 100%);
      border-radius: 16px;
      box-shadow: 0 4px 20px rgba(53, 104, 151, 0.295);
      overflow: hidden;
      width: 100%;
    }
    
    .player-main-info {
      display: flex;
      align-items: center;
      width: 100%;
      margin-bottom: 0;
      flex-wrap: nowrap;
      min-width: 0;
      justify-content: space-between;
      gap: 1rem;
    }
    
    
    .player-avatar {
      width: 70px;
      height: 70px;
      border-radius: 50%;
      background: linear-gradient(135deg, #4da8ff, #0077ff);
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 1.8rem;
      font-size: 2.2rem;
      color: white;
      box-shadow: 0 4px 15px rgba(0, 119, 255, 0.25);
      flex-shrink: 0;
      position: relative;
      z-index: 1;
      border: 3px solid white;
    }
    
    .player-details {
      display: flex;
      flex-direction: column;
      min-width: 0;
      flex: 1;
    }
    
    .player-details h3 {
      margin: 0;
      color: #1a365d;
      font-size: 1.6rem;
      font-weight: 700;
      letter-spacing: -0.3px;
      text-shadow: 0 1px 1px rgba(0,0,0,0.05);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 100%;
    }
    
    .player-rank {
      display: inline-block;
      color: #4a5568;
      font-size: 0.95rem;
      font-weight: 500;
      margin: 0 1rem 0 0;
      padding: 0;
      background: none !important;
      border: none !important;
      box-shadow: none !important;
      white-space: nowrap;
    }
    
    .player-stats-grid {
      display: flex;
      gap: 1rem;
      align-items: center;
      margin: 0;
      padding: 0;
      border: none;
      flex-shrink: 0;
    }
    
    .stat-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      position: relative;
      min-width: 60px;
    }
    
    .stat-card.mini::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: 0.5s;
    }
    
    .stat-card.mini:hover::before {
      left: 100%;
    }
    
    .stat-card.mini:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 25px rgba(0,0,0,0.15);
    }
    
    .stat-card.mini.gold { 
      background: linear-gradient(135deg, #FFD700, #FFA500);
    }
    
    .stat-card.mini.silver { 
      background: linear-gradient(135deg, #C0C0C0, #A0A0A0);
    }
    
    .stat-card.mini.bronze { 
      background: linear-gradient(135deg, #CD7F32, #8B4513);
    }
    
    .stat-item:hover {
      transform: translateY(-2px);
      transition: transform 0.2s ease;
    }
    
    .stat-card.mini:hover .stat-value {
      animation: pulse 0.5s ease;
    }
    
    .stat-card.mini .stat-value::after {
      content: '';
      position: absolute;
      bottom: -5px;
      left: 50%;
      transform: translateX(-50%);
      width: 50px;
      height: 2px;
      background: rgba(255,255,255,0.7);
      transition: all 0.3s ease;
    }
    
    .stat-card.mini:hover .stat-value::after {
      width: 70px;
      background: white;
    }
    
    .stat-label {
      font-size: 0.9rem;
      color: rgba(255,255,255,0.9);
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      text-shadow: 0 1px 2px rgba(0,0,0,0.2);
      margin-top: 0.2rem;
    }
    
    .player-section {
      margin-top: 1.5rem;
    }
    
    .player-section h3 {
      color: #444;
      margin-bottom: 1rem;
      font-size: 1.1rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .player-history-container {
      background: #f8f9fa;
      border-radius: 8px;
      padding: 1rem;
      max-height: 250px;
      overflow-y: auto;
    }
    
    .history-item {
      display: flex;
      align-items: center;
      padding: 0.7rem;
      margin-bottom: 0.5rem;
      background: white;
      border-radius: 6px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.05);
      transition: transform 0.2s;
    }
    
    .history-item:hover {
      transform: translateX(3px);
    }
    
    .empty-state {
      text-align: center;
      color: #999;
      padding: 1.5rem 0;
      font-style: italic;
    }
    
    /* Estilos responsivos */
    @media (max-width: 768px) {
      .player-info {
        flex-direction: row;
        align-items: center;
        justify-content: space-between;
        text-align: left;
        gap: 15px;
      }
      
      .player-main-info {
        display: flex;
        align-items: center;
        flex: 1;
        gap: 12px;
      }
      
      .player-avatar {
        margin: 0;
        flex-shrink: 0;
      }
      
      .player-details {
        flex: 1;
        min-width: 0;
      }
      
      .player-details h3 {
        font-size: 1.2rem;
        margin: 0 0 2px 0;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }
      
      .player-rank {
        font-size: 0.9rem;
        margin: 0;
        white-space: nowrap;
      }
      
      .player-stats-grid {
        display: flex;
        gap: 8px;
        margin: 0;
        flex-shrink: 0;
      }
      
      .stat-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 4px 8px !important;
        min-width: 50px;
        margin: 0 !important;
      }
      
      .stat-item span:first-child {
        font-size: 1.4rem !important;
        line-height: 1;
      }
      
      .stat-item span:last-child {
        font-size: 0.9rem !important;
        margin-top: 2px !important;
        font-weight: 600 !important;
      }
      
      @media (max-width: 480px) {
        .player-details h3 {
          font-size: 1.1rem;
        }
        
        .player-rank {
          font-size: 0.85rem;
        }
        
        .stat-item {
          min-width: 45px;
          padding: 3px 6px !important;
        }
        
        .stat-item span:first-child {
          font-size: 1.2rem !important;
        }
        
        .stat-item span:last-child {
          font-size: 0.8rem !important;
        }
      }
    }
  </style>
</head>
<body>
  <header>
    <h1 class="main-title">Estad√≠sticas</h1>
  </header>
  

  <main class="stats-container">
    <a href="index.html" class="btn-back">‚Üê Volver al Ranking</a>
    
    <div class="stat-card">
      <h2>üìä Distribuci√≥n de Medallas</h2>
      <div class="chart-container">
        <canvas id="medalsChart"></canvas>
      </div>
    </div>
    
    <div class="stat-card">
      <h2>üèÖ Total de Medallas</h2>
      <div class="medal-stats">
        <div class="medal-stat gold" onclick="animateMedalCount('totalGold')">
          <span>ü•á Oro</span>
          <div class="count" id="totalGold">0</div>
          <span id="goldLabel">medallas de oro</span>
        </div>
        <div class="medal-stat silver" onclick="animateMedalCount('totalSilver')">
          <span>ü•à Plata</span>
          <div class="count" id="totalSilver">0</div>
          <span id="silverLabel">medallas de plata</span>
        </div>
        <div class="medal-stat bronze" onclick="animateMedalCount('totalBronze')">
          <span>ü•â Bronce</span>
          <div class="count" id="totalBronze">0</div>
          <span id="bronzeLabel">medallas de bronce</span>
        </div>
      </div>
    </div>
    
    <div class="stat-card">
      <div class="achievements-header">
        <h2>üïí Historial Reciente</h2>
        <button id="btnReiniciarHistorial" class="btn-secondary" title="Reiniciar historial de medallas">
          <i class="fas fa-trash-alt"></i> Reiniciar Historial
        </button>
      </div>
      <div id="recentHistoryContainer">
        <div class="history-loading">Cargando historial reciente...</div>
      </div>
    </div>
    
    <div class="stat-card">
      <div class="achievements-header" style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;">
        <h2 style="margin: 0;">üë§ Perfil del Jugador</h2>
        <div class="player-selector-container">
          <i class="fas fa-user player-selector-icon"></i>
          <select id="playerSelector" class="player-selector">
            <option value="">Selecciona un jugador</option>
            <!-- Los jugadores se cargar√°n din√°micamente -->
          </select>
        </div>
      </div>
      <div id="playerProfileContainer" class="player-profile-section">
        <div class="player-info">
          <div class="player-main-info">
            <div class="player-avatar">
              <span id="playerInitial">üë§</span>
            </div>
            <div class="player-details">
              <h3 id="playerName">Selecciona un jugador</h3>
              <div class="player-rank" id="playerRank">Puesto: -</div>
            </div>
          </div>
          
          <div class="player-stats-grid">
            <div class="stat-item" style="color: #FFD700;">
              <span style="font-size: 1.6rem;">ü•á</span>
              <span style="font-size: 1.1rem; font-weight: 600; margin-top: 0.2rem;" id="playerGold">0</span>
            </div>
            <div class="stat-item" style="color: #C0C0C0;">
              <span style="font-size: 1.6rem;">ü•à</span>
              <span style="font-size: 1.1rem; font-weight: 600; margin-top: 0.2rem;" id="playerSilver">0</span>
            </div>
            <div class="stat-item" style="color: #CD7F32;">
              <span style="font-size: 1.6rem;">ü•â</span>
              <span style="font-size: 1.1rem; font-weight: 600; margin-top: 0.2rem;" id="playerBronze">0</span>
            </div>

          </div>
        </div>
        
        <div class="player-section">
          <h3>üìÖ Historial Reciente</h3>
          <div class="player-history-container" id="playerHistory">
            <div class="empty-state">No hay historial reciente</div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="stat-card">
      <div class="achievements-header">
        <h2>üèÜ Logros Destacados</h2>
        <button id="btnReiniciarContadores" class="btn-secondary" title="Reiniciar contadores de logros">
          <i class="fas fa-sync-alt"></i> Reiniciar Contadores
        </button>
      </div>
      <div id="achievementsContainer">
        <!-- Los logros se insertar√°n aqu√≠ din√°micamente -->
      </div>
    </div>
    
    <a href="index.html" class="btn-back">‚Üê Volver al Ranking</a>
  </main>

  <footer>
    <br><br>
    <center><p> 2025 Juegos Ol√≠mpicos de Martinez | P√°gina oficial</p></center>
    <br>
  </footer>

  <script>

    
    // Funci√≥n para mostrar ventana de confirmaci√≥n personalizada
    function showConfirm(message, callback) {
      // Crear elementos del modal
      const modal = document.createElement('div');
      modal.className = 'modal';
      
      const content = document.createElement('div');
      content.className = 'modal-content';
      content.style.maxWidth = '400px';
      content.style.padding = '20px';
      content.style.textAlign = 'center';
      
      // A√±adir mensaje
      const messageEl = document.createElement('p');
      messageEl.textContent = message;
      messageEl.style.marginBottom = '20px';
      messageEl.style.whiteSpace = 'pre-line';
      
      // Crear botones
      const btnContainer = document.createElement('div');
      btnContainer.style.display = 'flex';
      btnContainer.style.justifyContent = 'center';
      btnContainer.style.gap = '10px';
      
      const btnOk = document.createElement('button');
      btnOk.textContent = 'Aceptar';
      btnOk.className = 'btn';
      btnOk.style.backgroundColor = '#2196F3';
      btnOk.style.color = 'white';
      
      const btnCancel = document.createElement('button');
      btnCancel.textContent = 'Cancelar';
      btnCancel.className = 'btn';
      btnCancel.style.backgroundColor = '#607D8B';
      btnCancel.style.color = 'white';
      
      // A√±adir manejadores de eventos
      btnOk.onclick = function() {
        document.body.removeChild(modal);
        callback(true);
      };
      
      btnCancel.onclick = function() {
        document.body.removeChild(modal);
        callback(false);
      };
      
      // Construir el modal
      btnContainer.appendChild(btnCancel);
      btnContainer.appendChild(btnOk);
      content.appendChild(messageEl);
      content.appendChild(btnContainer);
      modal.appendChild(content);
      
      // A√±adir estilos al modal
      Object.assign(modal.style, {
        position: 'fixed',
        top: '0',
        left: '0',
        width: '100%',
        height: '100%',
        backgroundColor: 'rgba(0,0,0,0.5)',
        display: 'flex',
        justifyContent: 'center',
        alignItems: 'center',
        zIndex: '1000'
      });
      
      Object.assign(content.style, {
        backgroundColor: 'white',
        padding: '20px',
        borderRadius: '8px',
        boxShadow: '0 4px 8px rgba(0,0,0,0.2)'
      });
      
      // A√±adir el modal al documento
      document.body.appendChild(modal);
    }

    // Funci√≥n para mostrar di√°logo de confirmaci√≥n personalizado
    function showConfirm(message, callback) {
      // Crear elementos del modal
      const modal = document.createElement('div');
      modal.className = 'modal';
      modal.style.position = 'fixed';
      modal.style.top = '0';
      modal.style.left = '0';
      modal.style.width = '100%';
      modal.style.height = '100%';
      modal.style.backgroundColor = 'rgba(0,0,0,0.7)';
      modal.style.display = 'flex';
      modal.style.justifyContent = 'center';
      modal.style.alignItems = 'center';
      modal.style.zIndex = '1000';
      
      const content = document.createElement('div');
      content.className = 'modal-content';
      content.style.backgroundColor = 'white';
      content.style.padding = '20px';
      content.style.borderRadius = '8px';
      content.style.maxWidth = '400px';
      content.style.width = '90%';
      content.style.textAlign = 'center';
      content.style.boxShadow = '0 4px 8px rgba(0,0,0,0.2)';
      
      // A√±adir mensaje
      const messageEl = document.createElement('p');
      messageEl.textContent = message;
      messageEl.style.marginBottom = '20px';
      messageEl.style.whiteSpace = 'pre-line';
      
      // Crear botones
      const btnContainer = document.createElement('div');
      btnContainer.style.display = 'flex';
      btnContainer.style.justifyContent = 'center';
      btnContainer.style.gap = '10px';
      
      const btnOk = document.createElement('button');
      btnOk.textContent = 'Aceptar';
      btnOk.className = 'btn';
      btnOk.style.backgroundColor = '#2196F3';
      btnOk.style.color = 'white';
      btnOk.style.padding = '8px 16px';
      btnOk.style.border = 'none';
      btnOk.style.borderRadius = '4px';
      btnOk.style.cursor = 'pointer';
      
      const btnCancel = document.createElement('button');
      btnCancel.textContent = 'Cancelar';
      btnCancel.className = 'btn';
      btnCancel.style.backgroundColor = '#607D8B';
      btnCancel.style.color = 'white';
      btnCancel.style.padding = '8px 16px';
      btnCancel.style.border = 'none';
      btnCancel.style.borderRadius = '4px';
      btnCancel.style.cursor = 'pointer';
      
      // A√±adir manejadores de eventos
      btnOk.onclick = function() {
        document.body.removeChild(modal);
        callback(true);
      };
      
      btnCancel.onclick = function() {
        document.body.removeChild(modal);
        callback(false);
      };
      
      // Construir el modal
      btnContainer.appendChild(btnCancel);
      btnContainer.appendChild(btnOk);
      
      content.appendChild(messageEl);
      content.appendChild(btnContainer);
      modal.appendChild(content);
      
      // A√±adir al documento
      document.body.appendChild(modal);
    }
    
    // Funci√≥n para verificar logros desbloqueados (sin mostrar notificaciones)
    function checkForNewAchievements() {
      const lastShownAchievements = JSON.parse(localStorage.getItem('lastShownAchievements') || '[]');
      const unlockedAchievements = JSON.parse(localStorage.getItem('unlockedAchievements') || '{}');
      
      // Verificar cada participante
      Object.entries(unlockedAchievements).forEach(([participant, achievements]) => {
        if (!Array.isArray(achievements)) return;
        
        achievements.forEach(achievement => {
          const achievementKey = `${participant}_${achievement}`;
          
          if (!lastShownAchievements.includes(achievementKey)) {
            // Marcar como mostrado
            lastShownAchievements.push(achievementKey);
          }
        });
      });
      
      // Guardar logros mostrados
      localStorage.setItem('lastShownAchievements', JSON.stringify(lastShownAchievements));
    }
    
// Funci√≥n para reiniciar los contadores de logros
function reiniciarContadores() {
      console.log('Bot√≥n Reiniciar Contadores presionado');
      
      showConfirm('¬øEst√°s seguro de que deseas reiniciar SOLO los logros?\n\n‚ö†Ô∏è Esta acci√≥n solo afectar√° a los logros desbloqueados y no modificar√° las medallas ni otros datos del juego.\n\nEsta acci√≥n no se puede deshacer.', function(confirmed) {
        if (confirmed) {
          console.log('Iniciando reinicio de logros...');
          
          try {
            // 1. Limpiar solo las claves relacionadas con logros en localStorage
            console.log('Limpiando logros del localStorage...');
            const keysToRemove = [
              'unlockedAchievements',
              'lastShownAchievements',
              'logrosActivos',
              'logrosEspeciales',
              'mejoresComebacks',
              'historialPrimerPuesto',  // Para Esp√≠ritu de F√©nix
              'estrellaFugaz',
              'rachaOros',
              'mejorasTotales',
              'cambioDeSuerte',
              'caidasLibres',
              'ganadoresNumeroSuerte',
              'ganadoresElDiablo',
              'historialClasificacion',  // Para Fiebre del Oro
              'rachaOrosActual',        // Para Fiebre del Oro
              'ultimoGanadorOro',       // Para Fiebre del Oro
              'medalDates',             // Para Estrella Fugaz
              'fechasMedallas',         // Para Estrella Fugaz
              'medallasPorDia'          // Para Estrella Fugaz
            ];
            
            keysToRemove.forEach(key => {
              localStorage.removeItem(key);
              console.log(`Eliminado del localStorage: ${key}`);
            });
            
            // 2. Limpiar variables en memoria relacionadas con logros
            console.log('Limpiando variables de logros en memoria...');
            const variablesToClear = [
              'unlockedAchievements',
              'lastShownAchievements',
              'logrosActivos',
              'logrosEspeciales',
              'mejoresComebacks',
              'historialPrimerPuesto',  // Para Esp√≠ritu de F√©nix
              'estrellaFugaz',
              'rachaOros',
              'mejorasTotales',
              'cambioDeSuerte',
              'caidasLibres',
              'ganadoresNumeroSuerte',
              'ganadoresElDiablo',
              'historialClasificacion',  // Para Fiebre del Oro
              'rachaOrosActual',        // Para Fiebre del Oro
              'ultimoGanadorOro',       // Para Fiebre del Oro
              'fechasMedallas',         // Para Estrella Fugaz
              'medallasPorDia'          // Para Estrella Fugaz
            ];
            
            // Limpiar tambi√©n las variables temporales de Estrella Fugaz
            if (window.fechasMedallas) window.fechasMedallas = [];
            if (window.medallasPorDia) window.medallasPorDia = {};
            
            // 3. Limpiar el contenedor de logros en la UI
            const container = document.getElementById('achievementsContainer');
            if (container) {
              container.innerHTML = '';
              console.log('Contenedor de logros limpiado');
            }
            
            // 4. Recargar la p√°gina para actualizar la UI
            console.log('Recargando la p√°gina...');
            window.location.reload();
            
          } catch (error) {
            console.error('Error durante el reinicio de logros:', error);
            alert('Ocurri√≥ un error al reiniciar los logros. Por favor, recarga la p√°gina manualmente.');
          }
        } else {
          console.log('Usuario cancel√≥ el reinicio de logros');
        }
      });
    }
    
    // Funci√≥n para animar el conteo de medallas al hacer clic
    function animateMedalCount(elementId) {
      const element = document.getElementById(elementId);
      if (!element) return;
      
      // Agregar clase de animaci√≥n
      element.classList.add('counting');
      
      // Eliminar la clase despu√©s de la animaci√≥n
      setTimeout(() => {
        element.classList.remove('counting');
      }, 500);
    }
    
    // Funci√≥n para cargar la lista de jugadores en el selector
    function cargarJugadores() {
      try {
        console.log('Cargando lista de jugadores desde la tabla principal...');
        
        // Obtener participantes del localStorage (usando la misma clave que en script.js)
        const participantesGuardados = localStorage.getItem('olimpMartinez2025');
        console.log('Datos de participantes en localStorage:', participantesGuardados);
        
        // Verificar si hay datos y convertirlos a JSON
        let jugadores = [];
        if (participantesGuardados) {
          try {
            const datosCrudos = JSON.parse(participantesGuardados);
            
            // Verificar si es un array y convertir al formato esperado
            if (Array.isArray(datosCrudos)) {
              jugadores = datosCrudos.map(jugador => ({
                nombre: jugador.name || 'Sin nombre',
                oro: parseInt(jugador.gold) || 0,
                plata: parseInt(jugador.silver) || 0,
                bronce: parseInt(jugador.bronze) || 0
              }));
              
              console.log('Jugadores convertidos:', jugadores);
            } else {
              console.error('Los datos de participantes no son un array:', datosCrudos);
              jugadores = [];
            }
          } catch (error) {
            console.error('Error al analizar los datos de participantes:', error);
            jugadores = [];
          }
        }
        
        const playerSelector = document.getElementById('playerSelector');
        if (!playerSelector) {
          console.error('No se encontr√≥ el elemento playerSelector');
          return;
        }
        
        // Eliminar cualquier manejador de eventos existente para evitar duplicados
        const newPlayerSelector = playerSelector.cloneNode(true);
        playerSelector.parentNode.replaceChild(newPlayerSelector, playerSelector);
        
        console.log('Jugadores encontrados:', jugadores);
        
        // Limpiar todas las opciones existentes
        while (newPlayerSelector.options.length > 0) {
          newPlayerSelector.remove(0);
        }
        
        // Ordenar jugadores por nombre
        const jugadoresOrdenados = [...jugadores].sort((a, b) => {
          return a.nombre.localeCompare(b.nombre);
        });
        
        // Agregar jugadores al selector
        jugadoresOrdenados.forEach(jugador => {
          if (jugador && jugador.nombre) {
            const option = document.createElement('option');
            option.value = jugador.nombre;
            option.textContent = jugador.nombre;
            newPlayerSelector.appendChild(option);
          } else {
            console.warn('Jugador inv√°lido encontrado:', jugador);
          }
        });
        
        console.log(`Se cargaron ${jugadoresOrdenados.length} jugadores en el selector`);
        
        // Configurar evento de cambio
        newPlayerSelector.addEventListener('change', function() {
          const nombreJugador = this.value;
          console.log('Jugador seleccionado:', nombreJugador);
          
          if (nombreJugador) {
            mostrarPerfilJugador(nombreJugador);
            // Mostrar la secci√≥n del perfil
            const profileContainer = document.getElementById('playerProfileContainer');
            if (profileContainer) {
              profileContainer.style.display = 'block';
            }
          } else {
            // Ocultar la secci√≥n del perfil si no hay jugador seleccionado
            const profileContainer = document.getElementById('playerProfileContainer');
            if (profileContainer) {
              profileContainer.style.display = 'none';
            }
          }
        });
        
        // Seleccionar autom√°ticamente el primer jugador si hay alguno
        if (jugadoresOrdenados.length > 0) {
          newPlayerSelector.value = jugadoresOrdenados[0].nombre;
          // Disparar el evento de cambio despu√©s de un peque√±o retraso para asegurar que el DOM est√© listo
          setTimeout(() => {
            newPlayerSelector.dispatchEvent(new Event('change'));
          }, 100);
        }
        
      } catch (error) {
        console.error('Error en cargarJugadores:', error);
      }
    }
    
    // Funci√≥n para mostrar el perfil de un jugador
    function mostrarPerfilJugador(nombreJugador) {
      try {
        console.log('Mostrando perfil para:', nombreJugador);
        
        // Validar par√°metro de entrada
        if (!nombreJugador || typeof nombreJugador !== 'string') {
          console.error('Nombre de jugador no v√°lido:', nombreJugador);
          return;
        }
        
        // Obtener jugadores del localStorage con manejo de errores (usando la misma clave que en cargarJugadores)
        let jugadoresGuardados = [];
        try {
          const jugadoresGuardadosStr = localStorage.getItem('olimpMartinez2025');
          if (jugadoresGuardadosStr) {
            const datosCrudos = JSON.parse(jugadoresGuardadosStr);
            if (Array.isArray(datosCrudos)) {
              // Convertir al formato esperado (igual que en cargarJugadores)
              jugadoresGuardados = datosCrudos.map(jugador => ({
                nombre: jugador.name || 'Sin nombre',
                oro: parseInt(jugador.gold) || 0,
                plata: parseInt(jugador.silver) || 0,
                bronce: parseInt(jugador.bronze) || 0
              }));
              console.log('Datos de jugadores cargados:', jugadoresGuardados);
            } else {
              console.error('Los datos de participantes no son un array:', datosCrudos);
              jugadoresGuardados = [];
            }
          } else {
            console.warn('No se encontraron datos de participantes en localStorage');
          }
        } catch (error) {
          console.error('Error al cargar los datos de participantes:', error);
          jugadoresGuardados = [];
        }
        
        // Buscar el jugador por nombre (case insensitive para mayor robustez)
        const nombreJugadorLower = nombreJugador.toLowerCase();
        const jugador = jugadoresGuardados.find(j => j && j.nombre && j.nombre.toLowerCase() === nombreJugadorLower);
        
        console.log('Jugador encontrado:', jugador);
        
        if (!jugador) {
          console.error('No se encontr√≥ el jugador:', nombreJugador);
          return;
        }
        
        console.log('Datos del jugador encontrado:', jugador);
        
        // Mostrar contenedor de perfil
        const profileContainer = document.getElementById('playerProfileContainer');
        if (!profileContainer) {
          console.error('No se encontr√≥ el contenedor del perfil');
          return;
        }
        
        profileContainer.style.display = 'block';
        
        // Funci√≥n segura para actualizar elementos del DOM
        const actualizarElemento = (id, valor, valorPorDefecto = '') => {
          const elemento = document.getElementById(id);
          if (elemento) {
            elemento.textContent = valor !== undefined && valor !== null ? valor : valorPorDefecto;
          } else {
            console.warn(`Elemento no encontrado: ${id}`);
          }
        };
        
        // Actualizar informaci√≥n b√°sica
        actualizarElemento('playerName', jugador.nombre, 'Jugador');
        
        const inicial = jugador.nombre && jugador.nombre.length > 0 
          ? jugador.nombre.charAt(0).toUpperCase() 
          : 'üë§';
        actualizarElemento('playerInitial', inicial);
        
        // Calcular el total de medallas
        const totalMedallas = (parseInt(jugador.oro) || 0) + 
                            (parseInt(jugador.plata) || 0) + 
                            (parseInt(jugador.bronce) || 0);
        
        // Calcular posici√≥n en el ranking
        try {
          const jugadoresOrdenados = [...jugadoresGuardados]
            .filter(j => j && j.nombre) // Filtrar jugadores v√°lidos
            .sort((a, b) => {
              const puntajeA = (parseInt(a.oro) || 0) * 3 + 
                             (parseInt(a.plata) || 0) * 2 + 
                             (parseInt(a.bronce) || 0);
              const puntajeB = (parseInt(b.oro) || 0) * 3 + 
                             (parseInt(b.plata) || 0) * 2 + 
                             (parseInt(b.bronce) || 0);
              return puntajeB - puntajeA;
            });
            
          // Encontrar la posici√≥n del jugador actual
          const posicion = jugadoresOrdenados.findIndex(j => 
            j && j.nombre && j.nombre.toLowerCase() === nombreJugadorLower
          ) + 1; // +1 porque los √≠ndices empiezan en 0
          
          // Formatear el puesto (1¬∫, 2¬∫, 3¬∫, etc.)
          let sufijo = '¬∫';
          const puestoFormateado = `${posicion}${sufijo}`;
          
          // Actualizar la informaci√≥n del perfil
          actualizarElemento('playerInitial', puestoFormateado);
          actualizarElemento('playerRank', `${totalMedallas} medallas`, '0 medallas');
        } catch (error) {
          console.error('Error al calcular la posici√≥n en el ranking:', error);
          actualizarElemento('playerRank', 'Puesto: -');
        }
        
        // Actualizar estad√≠sticas de medallas
        actualizarElemento('playerGold', jugador.oro, '0');
        actualizarElemento('playerSilver', jugador.plata, '0');
        actualizarElemento('playerBronze', jugador.bronce, '0');
        
        // Obtener y mostrar la mejor racha de medallas de oro
        const estadisticasJugadores = JSON.parse(localStorage.getItem('estadisticasJugadores') || '{}');
        const mejorRacha = (estadisticasJugadores[jugador.nombre]?.mejorRachaOro) || 0;
        actualizarElemento('playerBestStreak', mejorRacha, '0');
        
        // Cargar historial del jugador
        try {
          cargarHistorialJugador(jugador.nombre);
          
          // Verificar despu√©s de actualizar
          setTimeout(() => {
            // Forzar actualizaci√≥n de la interfaz
            document.querySelectorAll('.stat-item').forEach(el => el.style.display = 'none');
            setTimeout(() => {
              document.querySelectorAll('.stat-item').forEach(el => el.style.display = 'flex');
            }, 10);
          }, 100);
          
        } catch (error) {
          console.error('Error al cargar el historial del jugador:', error);
        }
        
      } catch (error) {
        console.error('Error en mostrarPerfilJugador:', error);
      }
    }
    
    // Funci√≥n para cargar el historial de un jugador
    function cargarHistorialJugador(nombreJugador) {
      const historial = JSON.parse(localStorage.getItem('medalDatesHistorial') || '[]');
      const fechasMedallas = JSON.parse(localStorage.getItem('medalDates') || '[]');
      
      // Calcular la mejor racha de medallas de oro
      let mejorRacha = 0;
      
      // Filtrar solo las medallas de oro del jugador
      // Buscar tanto en el historial como en las fechas de medallas
      const medallasOro = [
        ...historial.filter(item => 
          item.participant === nombreJugador && item.type === 'gold'
        ),
        ...fechasMedallas.filter(medal => 
          medal.participant === nombreJugador && 
          (medal.medalType === 'gold' || medal.type === 'gold')
        )
      ];
      
      console.log('Medallas de oro encontradas para', nombreJugador, ':', medallasOro);
      
      // Crear un mapa de fechas √∫nicas con medallas de oro
      const fechasConOro = new Set();
      medallasOro.forEach(medal => {
        if (medal.date) {
          fechasConOro.add(medal.date);
        } else if (medal.timestamp) {
          // Si no hay fecha pero s√≠ timestamp, convertir a formato de fecha (YYYY-MM-DD)
          const fecha = new Date(parseInt(medal.timestamp));
          const fechaStr = fecha.toISOString().split('T')[0];
          fechasConOro.add(fechaStr);
        }
      });
      
      // Ordenar las fechas
      const fechasOrdenadas = Array.from(fechasConOro).sort();
      
      // Calcular la racha m√°s larga de d√≠as consecutivos con al menos una medalla de oro
      if (fechasOrdenadas.length > 0) {
        let rachaActual = 1;
        mejorRacha = 1;
        
        for (let i = 1; i < fechasOrdenadas.length; i++) {
          const fechaActual = new Date(fechasOrdenadas[i]);
          const fechaAnterior = new Date(fechasOrdenadas[i-1]);
          
          // Calcular la diferencia en d√≠as
          const diffTime = Math.abs(fechaActual - fechaAnterior);
          const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
          
          if (diffDays === 1) {
            // D√≠as consecutivos
            rachaActual++;
            if (rachaActual > mejorRacha) {
              mejorRacha = rachaActual;
            }
          } else if (diffDays > 1) {
            // Reiniciar la racha si hay m√°s de un d√≠a de diferencia
            rachaActual = 1;
          }
        }
      }
      
      // Obtener los 10 eventos m√°s recientes (usando el historial original)
      const historialOrdenado = [...historial]
        .filter(item => item.participant === nombreJugador)
        .sort((a, b) => a.timestamp - b.timestamp);
      
      // Guardar la mejor racha en localStorage para mostrarla en el perfil
      const estadisticasJugadores = JSON.parse(localStorage.getItem('estadisticasJugadores') || '{}');
      if (!estadisticasJugadores[nombreJugador]) {
        estadisticasJugadores[nombreJugador] = {};
      }
      estadisticasJugadores[nombreJugador].mejorRachaOro = mejorRacha;
      localStorage.setItem('estadisticasJugadores', JSON.stringify(estadisticasJugadores));
      
      // Obtener los 10 eventos m√°s recientes
      const historialJugador = historialOrdenado
        .slice(-10) // Tomar los 10 m√°s recientes
        .reverse()  // Ordenar del m√°s reciente al m√°s antiguo
        .map(item => ({
          ...item,
          fecha: new Date(parseInt(item.timestamp)).toISOString(),
          medalla: item.type === 'gold' ? 'oro' : item.type === 'silver' ? 'plata' : 'bronce'
        }));
      
      const historyContainer = document.getElementById('playerHistory');
      
      if (historialJugador.length === 0) {
        historyContainer.innerHTML = '<div class="empty-state">No hay historial reciente</div>';
        return;
      }
      
      let html = '';
      historialJugador.forEach(item => {
        const fecha = new Date(item.fecha).toLocaleString('es-ES', {
          day: '2-digit',
          month: '2-digit',
          year: 'numeric',
          hour: '2-digit',
          minute: '2-digit'
        });
        const medalla = item.medalla.toLowerCase();
        const medallaIcono = medalla === 'oro' ? 'ü•á' : medalla === 'plata' ? 'ü•à' : 'ü•â';
        
        // Mapear los tipos de medalla a clases CSS
        const medallaClass = {
          'oro': 'gold',
          'plata': 'silver',
          'bronce': 'bronze'
        }[medalla] || '';
        
        html += `
          <div class="history-item ${medallaClass}">
            <div class="history-icon" style="color: ${medalla === 'oro' ? '#FFD700' : medalla === 'plata' ? '#C0C0C0' : '#CD7F32'}">${medallaIcono}</div>
            <div class="history-details">
              <div class="history-title">Medalla de ${item.medalla}</div>
              <div class="history-time">${fecha}</div>
            </div>
          </div>
        `;
      });
      
      historyContainer.innerHTML = html;
    }
    
    // Funci√≥n para inicializar datos de ejemplo si no existen
    function inicializarDatosEjemplo() {
      // Verificar si ya hay datos en localStorage
      const participantesGuardados = localStorage.getItem('participantes');
      
      // Si no hay datos o no es un array v√°lido, crear datos de ejemplo
      if (!participantesGuardados || !Array.isArray(JSON.parse(participantesGuardados)) || JSON.parse(participantesGuardados).length === 0) {
        console.log('Inicializando datos de ejemplo...');
        
        const jugadoresEjemplo = [
          { nombre: 'Jugador 1', oro: 5, plata: 3, bronce: 2 },
          { nombre: 'Jugador 2', oro: 3, plata: 4, bronce: 1 },
          { nombre: 'Jugador 3', oro: 2, plata: 1, bronce: 5 }
        ];
        
        localStorage.setItem('participantes', JSON.stringify(jugadoresEjemplo));
        console.log('Datos de ejemplo guardados en localStorage');
      } else {
        console.log('Ya existen datos de jugadores en localStorage');
      }
    }
    
    document.addEventListener('DOMContentLoaded', function() {
      // Inicializar datos de ejemplo si es necesario
      inicializarDatosEjemplo();
      
      // Cargar lista de jugadores
      cargarJugadores();
      
      // Configurar el bot√≥n de reiniciar contadores
      const btnReiniciarContadores = document.getElementById('btnReiniciarContadores');
      if (btnReiniciarContadores) {
        btnReiniciarContadores.addEventListener('click', reiniciarContadores);
      }
      
      // Configurar el bot√≥n de reiniciar historial
      const btnReiniciarHistorial = document.getElementById('btnReiniciarHistorial');
      if (btnReiniciarHistorial) {
        btnReiniciarHistorial.addEventListener('click', function() {
          showConfirm('¬øEst√°s seguro de que quieres reiniciar el historial de medallas?\n\n‚ö†Ô∏è Esta acci√≥n no se puede deshacer.', function(confirmed) {
            if (confirmed) {
              // Eliminar ambas versiones del historial para asegurar la limpieza
              localStorage.removeItem('medalDates');
              localStorage.removeItem('medalDatesHistorial');
              // Recargar la p√°gina para actualizar todas las estad√≠sticas
              window.location.reload();
            }
          });
        });
      }

      // Configurar el bot√≥n de reiniciar contadores
      const btnReiniciar = document.getElementById('btnReiniciarContadores');
      if (btnReiniciar) {
        btnReiniciar.style.display = 'flex';
        btnReiniciar.addEventListener('click', reiniciarContadores);
      }
      // Cargar datos desde localStorage
      const participants = JSON.parse(localStorage.getItem('olimpMartinez2025')) || [];
      
      // Calcular totales
      const totals = participants.reduce((acc, p) => {
        acc.gold += p.gold || 0;
        acc.silver += p.silver || 0;
        acc.bronze += p.bronze || 0;
        return acc;
      }, { gold: 0, silver: 0, bronze: 0 });
      
      // Actualizar contadores y etiquetas
      document.getElementById('totalGold').textContent = totals.gold;
      document.getElementById('goldLabel').textContent = totals.gold === 1 ? 'medalla de oro' : 'medallas de oro';
      
      document.getElementById('totalSilver').textContent = totals.silver;
      document.getElementById('silverLabel').textContent = totals.silver === 1 ? 'medalla de plata' : 'medallas de plata';
      
      document.getElementById('totalBronze').textContent = totals.bronze;
      document.getElementById('bronzeLabel').textContent = totals.bronze === 1 ? 'medalla de bronce' : 'medallas de bronce';
      
      // Gr√°fico de distribuci√≥n
      const ctx = document.getElementById('medalsChart').getContext('2d');
      new Chart(ctx, {
        type: 'bar',
        data: {
          labels: ['Oro', 'Plata', 'Bronce'],
          datasets: [{
            label: 'Total de Medallas',
            data: [totals.gold, totals.silver, totals.bronze],
            backgroundColor: [
              'rgba(255, 215, 0, 0.7)',
              'rgba(192, 192, 192, 0.7)',
              'rgba(205, 127, 50, 0.7)'
            ],
            borderColor: [
              'rgba(255, 215, 0, 1)',
              'rgba(192, 192, 192, 1)',
              'rgba(205, 127, 50, 1)'
            ],
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            y: {
              beginAtZero: true,
              ticks: {
                stepSize: 1
              }
            }
          },
          plugins: {
            legend: {
              display: false
            }
          }
        }
      });
      
      // Funci√≥n para cargar logros destacados
      function cargarLogrosDestacados() {
        const container = document.getElementById('achievementsContainer');
        container.innerHTML = '';
        
        // Obtener datos
        const participantes = JSON.parse(localStorage.getItem('olimpMartinez2025') || '[]');
        const medallas = JSON.parse(localStorage.getItem('medalDates') || '[]');
        
        // 1. Encontrar al participante con m√°s medallas totales
        const participantesConTotales = participantes.map(p => ({
          nombre: p.name,
          oro: p.gold || 0,
          plata: p.silver || 0,
          bronce: p.bronze || 0,
          total: (p.gold || 0) + (p.silver || 0) + (p.bronze || 0)
        })).sort((a, b) => b.total - a.total);
        
        // Funci√≥n para formatear lista de nombres
        function formatearNombres(nombres) {
          if (!nombres || nombres.length === 0) return '';
          if (nombres.length === 1) return nombres[0];
          if (nombres.length === 2) return `${nombres[0]} y ${nombres[1]}`;
          return nombres.slice(0, -1).join(', ') + ' y ' + nombres[nombres.length - 1];
        }

        // 2. Encontrar participantes que solo tengan medallas de oro
        const soloOro = participantesConTotales.filter(p => 
          p.oro > 0 && p.plata === 0 && p.bronce === 0
        );
        
        // 3. Encontrar participantes con equilibrio perfecto (mismo n√∫mero de oros, platas y bronces)
        const equilibrioPerfecto = participantesConTotales.filter(p => 
          p.oro > 0 && p.oro === p.plata && p.oro === p.bronce
        );

        // 4. Calcular racha de oros seguidos
        function calcularRachaOros(medallas) {
          // Ordenar todas las medallas por timestamp (ya incluye las de edici√≥n)
          const medallasOrdenadas = [...medallas].sort((a, b) => a.timestamp - b.timestamp);
          
          const rachasActuales = {}; // Raacha actual de cada participante
          const maxRachas = {};     // Mejor racha de cada participante
          
          // Primero, inicializar todos los participantes con racha 0
          const participantes = [...new Set(medallas.map(m => m.participant))];
          participantes.forEach(p => {
            rachasActuales[p] = 0;
            maxRachas[p] = 0;
          });
          
          // Procesar cada medalla en orden cronol√≥gico
          medallasOrdenadas.forEach(medal => {
            const participante = medal.participant;
            
            if (medal.type === 'gold') {
              // Si es oro, incrementar la racha actual
              rachasActuales[participante] = (rachasActuales[participante] || 0) + 1;
              
              // Actualizar la racha m√°xima si es necesario
              if (rachasActuales[participante] > maxRachas[participante]) {
                maxRachas[participante] = rachasActuales[participante];
              }
              
              // Reiniciar rachas de los otros participantes
              Object.keys(rachasActuales).forEach(p => {
                if (p !== participante) {
                  rachasActuales[p] = 0;
                }
              });
            } else {
              // Si no es oro, reiniciar la racha de este participante
              rachasActuales[participante] = 0;
            }
          });
          
          // Encontrar la mejor racha entre todos los participantes
          let mejorRacha = 0;
          let mejoresParticipantes = [];
          
          Object.entries(maxRachas).forEach(([participante, racha]) => {
            if (racha > mejorRacha) {
              mejorRacha = racha;
              mejoresParticipantes = [participante];
            } else if (racha === mejorRacha && racha > 0) {
              mejoresParticipantes.push(participante);
            }
          });
          
          return {
            participantes: mejoresParticipantes,
            racha: mejorRacha
          };
        }
        
        const rachaOros = calcularRachaOros(medallas);
        
        // 5. Logro "Actor Secundario" - Para quien tenga m√°s medallas de plata
        const actorSecundario = [];
        
        // Encontrar el n√∫mero m√°ximo de medallas de plata
        const maxPlata = Math.max(...participantesConTotales.map(p => p.plata));
        
        // Encontrar todos los participantes con ese m√°ximo de medallas de plata
        participantesConTotales.forEach(p => {
          if (p.plata === maxPlata && p.plata > 0) {
            actorSecundario.push({
              nombre: p.nombre,
              plata: p.plata
            });
          }
        });
        
        // Si hay al menos un participante con medallas de plata, mostrar el logro
        if (actorSecundario.length > 0) {
          const logroActorSecundario = document.createElement('div');
          logroActorSecundario.className = 'logro';
          logroActorSecundario.style.background = 'var(--logro-azul-fondo)';
          logroActorSecundario.style.borderLeft = '4px solid var(--logro-azul-borde)';
          
          // Formatear la frase seg√∫n el n√∫mero de ganadores
          const nombres = actorSecundario.map(p => p.nombre);
          const textoNombres = formatearNombres(nombres);
          const cantidadPlata = actorSecundario[0].plata;
          
          logroActorSecundario.innerHTML = `
            <div class="logro-icono">üé≠</div>
            <div class="logro-contenido">
              <h3>Actor Secundario</h3>
              <p>${textoNombres} ${actorSecundario.length > 1 ? 'tienen' : 'tiene'} m√°s medallas de plata (${cantidadPlata})</p>
              <div class="participantes-ganadores">
                ${actorSecundario.map(p => `
                  <div class="participante">
                    <strong>${p.nombre}:</strong>
                    <span class="silver">ü•à ${p.plata}</span>
                  </div>
                `).join('')}
              </div>
            </div>
          `;
          
          container.appendChild(logroActorSecundario);
        }
        
        // 5. Agrupar participantes por logros de "Estilo √önico"
        const estiloUnico = {
          oro: participantesConTotales.filter(p => p.oro > 0 && p.plata === 0 && p.bronce === 0),
          plata: participantesConTotales.filter(p => p.plata > 0 && p.oro === 0 && p.bronce === 0),
          bronce: participantesConTotales.filter(p => p.bronce > 0 && p.oro === 0 && p.plata === 0)
        };
        
        // 5. Logro "Comeback del a√±o" - Recuperar el primer puesto despu√©s de perderlo
        const historialPrimerPuesto = JSON.parse(localStorage.getItem('historialPrimerPuesto') || '{}');
        let maxVecesRecuperado = 0;
        const mejoresComebacks = [];
        
        // Primero encontrar el n√∫mero m√°ximo de recuperaciones
        Object.entries(historialPrimerPuesto).forEach(([nombre, datos]) => {
            if (datos.vecesRecuperado > 0) {
                if (datos.vecesRecuperado > maxVecesRecuperado) {
                    maxVecesRecuperado = datos.vecesRecuperado;
                }
            }
        });
        
        // Luego encontrar a todos los que tengan ese m√°ximo
        Object.entries(historialPrimerPuesto).forEach(([nombre, datos]) => {
            if (datos.vecesRecuperado === maxVecesRecuperado && maxVecesRecuperado > 0) {
                mejoresComebacks.push({
                    nombre: nombre,
                    veces: datos.vecesRecuperado,
                    ultimaVez: datos.ultimaRecuperacion
                });
            }
        });
        
        // Ordenar por la fecha de la √∫ltima recuperaci√≥n (m√°s reciente primero)
        mejoresComebacks.sort((a, b) => new Date(b.ultimaVez) - new Date(a.ultimaVez));
        
        // 6. Encontrar al Rey de la Monta√±a (primer puesto en la clasificaci√≥n)
        const reyMontana = [];
        if (participantesConTotales.length > 0) {
          // Ordenar por clasificaci√≥n (oro > plata > bronce)
          const clasificados = [...participantesConTotales].sort((a, b) => {
            if (a.oro !== b.oro) return b.oro - a.oro;
            if (a.plata !== b.plata) return b.plata - a.plata;
            return b.bronce - a.bronce;
          });
          
          // Tomar el/los primeros puestos
          const primerPuesto = clasificados[0];
          reyMontana.push(primerPuesto);
          
          // Verificar si hay empate en el primer puesto
          for (let i = 1; i < clasificados.length; i++) {
            if (clasificados[i].oro === primerPuesto.oro &&
                clasificados[i].plata === primerPuesto.plata &&
                clasificados[i].bronce === primerPuesto.bronce) {
              reyMontana.push(clasificados[i]);
            } else {
              break;
            }
          }
        }
        
        // 6. Encontrar al participante con m√°s posiciones subidas en total (Escalador Profesional)
        let mejorMejora = { nombre: null, mejoraTotal: 0, posicionActual: 0 };
        try {
          const mejorasTotales = JSON.parse(localStorage.getItem('mejorasTotales') || '{}');
          const historial = JSON.parse(localStorage.getItem('historialClasificacion') || '[]');
          const clasificacionActual = historial.length > 0 ? 
            historial[historial.length - 1].clasificacion : [];
          
          // Encontrar al participante con m√°s posiciones subidas en total
          Object.entries(mejorasTotales).forEach(([nombre, mejoraTotal]) => {
            if (mejoraTotal > mejorMejora.mejoraTotal) {
              const posicionActual = clasificacionActual.find(p => p.nombre === nombre)?.posicion || 0;
              mejorMejora = {
                nombre,
                mejoraTotal: parseInt(mejoraTotal),
                posicionActual: posicionActual
              };
            }
          });
        } catch (e) {
          console.error('Error al calcular mejoras de clasificaci√≥n:', e);
        }
        
        // Si hay participantes con medallas, mostrar el/los m√°ximos ganadores
        if (participantesConTotales.length > 0 && participantesConTotales[0].total > 0) {
          const maxTotal = participantesConTotales[0].total;
          const maximosGanadores = participantesConTotales.filter(p => p.total === maxTotal);
          
          // Crear elemento de logro para el/los m√°ximos ganadores
          const logro = document.createElement('div');
          logro.className = 'logro';
          
          if (maximosGanadores.length === 1) {
            const ganador = maximosGanadores[0];
            logro.innerHTML = `
              <div class="logro-icono">üëë</div>
              <div class="logro-contenido">
                <h3>Rey de las medallas</h3>
                <p>${ganador.nombre} lidera con ${ganador.total} medallas en total</p>
                <div class="medal-count">
                  <span class="gold">ü•á ${ganador.oro}</span>
                  <span class="silver">ü•à ${ganador.plata}</span>
                  <span class="bronze">ü•â ${ganador.bronce}</span>
                </div>
              </div>
            `;
          } else {
            const nombres = maximosGanadores.map(g => g.nombre);
            const textoNombres = formatearNombres(nombres);
            
            logro.innerHTML = `
              <div class="logro-icono">üëë</div>
              <div class="logro-contenido">
                <h3>Reyes de las medallas</h3>
                <p>${textoNombres} lideran con ${maxTotal} medallas cada uno</p>
                <div class="participantes-ganadores">
                  ${maximosGanadores.map(g => `
                    <div class="participante">
                      <strong>${g.nombre}:</strong>
                      <span class="gold">ü•á ${g.oro}</span>
                      <span class="silver">ü•à ${g.plata}</span>
                      <span class="bronze">ü•â ${g.bronce}</span>
                    </div>
                  `).join('')}
                </div>
              </div>
            `;
          }
          
          container.appendChild(logro);
        }
        
        // Mostrar logro "Comeback del a√±o" si hay datos
        if (mejoresComebacks.length > 0) {
            const logroComeback = document.createElement('div');
            logroComeback.className = 'logro';
            logroComeback.style.background = 'var(--logro-azul-fondo)';
            logroComeback.style.borderLeft = '4px solid var(--logro-azul-borde)';
            
            // Si hay un solo ganador
            if (mejoresComebacks.length === 1) {
                const mejor = mejoresComebacks[0];
                const fecha = new Date(mejor.ultimaVez).toLocaleDateString('es-ES', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
                
                logroComeback.innerHTML = `
                    <div class="logro-icono">üê¶</div>
                    <div class="logro-contenido">
                        <h3>Esp√≠ritu de F√©nix</h3>
                        <p>${mejor.nombre} ha recuperado el primer puesto ${mejor.veces} ${mejor.veces === 1 ? 'vez' : 'veces'}</p>
                        <p class="fecha-pequena">√öltima recuperaci√≥n: ${fecha}</p>
                    </div>
                `;
            } 
            // Si hay empate
            else {
                const nombres = mejoresComebacks.map(c => c.nombre);
                const textoNombres = formatearNombres(nombres);
                const veces = mejoresComebacks[0].veces;
                const fecha = new Date(mejoresComebacks[0].ultimaVez).toLocaleDateString('es-ES', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
                
                logroComeback.innerHTML = `
                    <div class="logro-icono">üê¶</div>
                    <div class="logro-contenido">
                        <h3>Esp√≠ritu de F√©nix</h3>
                        <p>${textoNombres} han recuperado el primer puesto ${veces} ${veces === 1 ? 'vez' : 'veces'}</p>
                        <p class="fecha-pequena">√öltima recuperaci√≥n: ${fecha}</p>
                        <div class="participantes-ganadores">
                            ${mejoresComebacks.map(c => `
                                <div class="participante">
                                    <strong>${c.nombre}:</strong>
                                    <span>${c.veces} ${c.veces === 1 ? 'vez' : 'veces'}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }
            
            container.appendChild(logroComeback);
        }
        
        // Mostrar logro de racha de oros si hay participantes que cumplan el criterio
        if (rachaOros.racha > 1) {
          const logroRachaOros = document.createElement('div');
          logroRachaOros.className = 'logro';
          logroRachaOros.style.background = 'var(--logro-oro-fondo)';
          logroRachaOros.style.borderLeft = '4px solid var(--logro-oro-borde)';
          
          const textoNombres = formatearNombres(rachaOros.participantes);
          
          logroRachaOros.innerHTML = `
            <div class="logro-icono">üå°Ô∏è</div>
            <div class="logro-contenido">
              <h3>Fiebre del Oro</h3>
              <p>${textoNombres} ${rachaOros.participantes.length > 1 ? 'tienen' : 'tiene'} la mayor racha de oros consecutivos con ${rachaOros.racha} oros seguidos sin que nadie m√°s ganara un oro entre medias</p>
            </div>
          `;
          container.appendChild(logroRachaOros);
        }
        
        // Mostrar logro "Pureza Dorada" si hay participantes que cumplan el criterio
        if (soloOro.length > 0) {
          const logroOro = document.createElement('div');
          logroOro.className = 'logro';
          logroOro.style.background = 'var(--logro-oro-fondo)';
          logroOro.style.borderLeft = '4px solid var(--logro-oro-borde)';
          
          const nombres = soloOro.map(p => p.nombre);
          const textoNombres = formatearNombres(nombres);
          const totalOros = soloOro.reduce((sum, p) => sum + p.oro, 0);
          
          logroOro.innerHTML = `
            <div class="logro-icono">ü§¥</div>
            <div class="logro-contenido">
              <h3>Rey Midas</h3>
              <p>${textoNombres} ${soloOro.length > 1 ? 'solo tienen' : 'solo tiene'} medallas de oro (${totalOros} en total)</p>
              <div class="participantes-ganadores">
                ${soloOro.map(p => `
                  <div class="participante">
                    <strong>${p.nombre}:</strong>
                    <span class="gold">ü•á ${p.oro} oro</span>
                  </div>
                `).join('')}
              </div>
            </div>
          `;
          container.appendChild(logroOro);
        }

        // Logro "N√∫mero de la Suerte" - 7 medallas de cada tipo
        const numeroSuerte = participantesConTotales.filter(p => 
          p.oro === 7 && p.plata === 7 && p.bronce === 7
        );
        
        // Obtener ganadores anteriores del localStorage o inicializar array vac√≠o
        const ganadoresNumeroSuerte = JSON.parse(localStorage.getItem('ganadoresNumeroSuerte') || '[]');
        
        // A√±adir nuevos ganadores si no est√°n ya en la lista
        numeroSuerte.forEach(ganador => {
          if (!ganadoresNumeroSuerte.includes(ganador.nombre)) {
            ganadoresNumeroSuerte.push(ganador.nombre);
          }
        });
        
        // Guardar en localStorage
        localStorage.setItem('ganadoresNumeroSuerte', JSON.stringify(ganadoresNumeroSuerte));
        
        // Mostrar logro si hay ganadores
        if (ganadoresNumeroSuerte.length > 0) {
          const logroSuerte = document.createElement('div');
          logroSuerte.className = 'logro';
          logroSuerte.style.background = 'var(--logro-verde-fondo)';
          logroSuerte.style.borderLeft = '4px solid var(--logro-verde-borde)';
          
          const textoNombres = formatearNombres(ganadoresNumeroSuerte);
          
          logroSuerte.innerHTML = `
            <div class="logro-icono">üçÄ</div>
            <div class="logro-contenido">
              <h3>N√∫mero de la Suerte</h3>
              <p>¬°${textoNombres} ${ganadoresNumeroSuerte.length > 1 ? 'han' : 'ha'} conseguido el n√∫mero de la suerte! 7 medallas de cada tipo (ü•á7 ü•à7 ü•â7)</p>
              <div class="participantes-ganadores">
                ${ganadoresNumeroSuerte.map(nombre => `
                `).join('')}
              </div>
            </div>
          `;
          container.appendChild(logroSuerte);
        }
        
        // Logro "El Diablo" - 6 medallas de cada tipo
        const elDiablo = participantesConTotales.filter(p => 
          p.oro === 6 && p.plata === 6 && p.bronce === 6
        );
        
        // Obtener ganadores anteriores del localStorage o inicializar array vac√≠o
        const ganadoresElDiablo = JSON.parse(localStorage.getItem('ganadoresElDiablo') || '[]');
        
        // A√±adir nuevos ganadores si no est√°n ya en la lista
        elDiablo.forEach(ganador => {
          if (!ganadoresElDiablo.includes(ganador.nombre)) {
            ganadoresElDiablo.push(ganador.nombre);
          }
        });
        
        // Guardar en localStorage
        localStorage.setItem('ganadoresElDiablo', JSON.stringify(ganadoresElDiablo));
        
        // Mostrar logro si hay ganadores
        if (ganadoresElDiablo.length > 0) {
          const logroDiablo = document.createElement('div');
          logroDiablo.className = 'logro';
          logroDiablo.style.background = 'var(--logro-morado-fondo)';
          logroDiablo.style.borderLeft = '4px solid var(--logro-morado-borde)';
          
          const textoNombres = formatearNombres(ganadoresElDiablo);
          
          logroDiablo.innerHTML = `
            <div class="logro-icono">üòà</div>
            <div class="logro-contenido">
              <h3>El Diablo</h3>
              <p>¬°${textoNombres} ${ganadoresElDiablo.length > 1 ? 'han' : 'ha'} conseguido ser el diablo! 6 medallas de cada tipo (ü•á6 ü•à6 ü•â6)</p>
              <div class="participantes-ganadores">
                ${ganadoresElDiablo.map(nombre => `
                `).join('')}
              </div>
            </div>
          `;
          container.appendChild(logroDiablo);
        }



        // Mostrar logro "Equilibrio Perfecto" si hay participantes que cumplan el criterio
        if (equilibrioPerfecto.length > 0) {
          const logroEquilibrio = document.createElement('div');
          logroEquilibrio.className = 'logro';
          logroEquilibrio.style.background = 'var(--logro-verde-fondo)';
          logroEquilibrio.style.borderLeft = '4px solid var(--logro-verde-borde)';
          
          const nombres = equilibrioPerfecto.map(p => p.nombre);
          const textoNombres = formatearNombres(nombres);
          const cantidad = equilibrioPerfecto[0].oro; // Todos tienen la misma cantidad
          
          logroEquilibrio.innerHTML = `
            <div class="logro-icono">‚öñÔ∏è</div>
            <div class="logro-contenido">
              <h3>Equilibrio Perfecto</h3>
              <p>${textoNombres} ${equilibrioPerfecto.length > 1 ? 'mantienen' : 'mantiene'} un equilibrio perfecto con ${cantidad} medallas de cada tipo</p>
              <div class="participantes-ganadores">
                ${equilibrioPerfecto.map(p => `
                  <div class="participante">
                    <strong>${p.nombre}:</strong>
                    <span class="gold">ü•á ${p.oro}</span>
                    <span class="silver">ü•à ${p.plata}</span>
                    <span class="bronze">ü•â ${p.bronce}</span>
                  </div>
                `).join('')}
              </div>
            </div>
          `;
          container.appendChild(logroEquilibrio);
        }
        
        // 7. Encontrar participantes que tengan al menos una medalla de cada tipo (Coleccionista)
        const coleccionistas = participantesConTotales.filter(p => 
          p.oro > 0 && p.plata > 0 && p.bronce > 0
        );
        
        // Mostrar logro "Coleccionista"
        if (coleccionistas.length > 0) {
          const logroColeccionista = document.createElement('div');
          logroColeccionista.className = 'logro';
          logroColeccionista.style.background = 'var(--logro-oro-fondo)';
          logroColeccionista.style.borderLeft = '4px solid var(--logro-oro-borde)';
          
          const nombres = coleccionistas.map(p => p.nombre);
          const textoNombres = formatearNombres(nombres);
          
          logroColeccionista.innerHTML = `
            <div class="logro-icono">üèÜ</div>
            <div class="logro-contenido">
              <h3>Coleccionista</h3>
              <p>${textoNombres} ${coleccionistas.length > 1 ? 'han' : 'ha'} completado su colecci√≥n con al menos una medalla de cada tipo</p>
              <div class="participantes-ganadores">
                ${coleccionistas.map(p => `
                  <div class="participante">
                    <strong>${p.nombre}:</strong>
                    <span class="gold">ü•á ${p.oro}</span>
                    <span class="silver">ü•à ${p.plata}</span>
                    <span class="bronze">ü•â ${p.bronce}</span>
                  </div>
                `).join('')}
              </div>
            </div>
          `;
          container.appendChild(logroColeccionista);
        }
        
        // 8. Mostrar logro "De Cero a Cien" (pasar de √∫ltimo a primero)
        const cambiosDeSuerte = JSON.parse(localStorage.getItem('cambioDeSuerte') || '{}');
        const ganadoresDeCeroACien = Object.entries(cambiosDeSuerte)
          .filter(([_, logrado]) => logrado)
          .map(([nombre]) => {
            const participante = participantesConTotales.find(p => p.nombre === nombre);
            return {
              nombre,
              oro: participante?.oro || 0,
              plata: participante?.plata || 0,
              bronce: participante?.bronce || 0
            };
          });
          
        if (ganadoresDeCeroACien.length > 0) {
          const logroDeCeroACien = document.createElement('div');
          logroDeCeroACien.className = 'logro';
          logroDeCeroACien.style.background = 'var(--logro-verde-fondo)';
          logroDeCeroACien.style.borderLeft = '4px solid var(--logro-verde-borde)';
          
          const nombres = ganadoresDeCeroACien.map(p => p.nombre);
          const textoNombres = formatearNombres(nombres);
          
          logroDeCeroACien.innerHTML = `
            <div class="logro-icono">üöÄ</div>
            <div class="logro-contenido">
              <h3>De Cero a Cien</h3>
              <p>${textoNombres} ${nombres.length > 1 ? 'han' : 'ha'} pasado de √∫ltimo a primero en la clasificaci√≥n</p>
              <div class="participantes-ganadores">
                ${ganadoresDeCeroACien.map(p => `
                  <div class="participante">
                    <strong>${p.nombre}:</strong>
                    <span class="gold">ü•á ${p.oro}</span>
                    <span class="silver">ü•à ${p.plata}</span>
                    <span class="bronze">ü•â ${p.bronce}</span>
                  </div>
                `).join('')}
              </div>
            </div>
          `;
          container.appendChild(logroDeCeroACien);
        }
        
        // 9. Mostrar logro "Ca√≠da Libre" (pasar de primero a √∫ltimo)
        const caidasLibres = JSON.parse(localStorage.getItem('caidasLibres') || '{}');
        const ganadoresCaidaLibre = Object.entries(caidasLibres)
          .filter(([_, logrado]) => logrado)
          .map(([nombre]) => {
            const participante = participantesConTotales.find(p => p.nombre === nombre);
            return {
              nombre,
              oro: participante?.oro || 0,
              plata: participante?.plata || 0,
              bronce: participante?.bronce || 0
            };
          });
          
        if (ganadoresCaidaLibre.length > 0) {
          const logroCaidaLibre = document.createElement('div');
          logroCaidaLibre.className = 'logro';
          logroCaidaLibre.setAttribute('data-emoji', 'üßä');
          logroCaidaLibre.style.background = 'var(--logro-azul-fondo, #e3f2fd)';
          logroCaidaLibre.style.borderLeft = '4px solid var(--logro-azul-borde, #2196f3)';
          
          const nombres = ganadoresCaidaLibre.map(p => p.nombre);
          const textoNombres = formatearNombres(nombres);
          
          logroCaidaLibre.innerHTML = `
            <div class="logro-icono">üßä</div>
            <div class="logro-contenido">
              <h3>Ca√≠da Libre</h3>
              <p>${textoNombres} ${nombres.length > 1 ? 'han' : 'ha'} pasado de primero a √∫ltimo en la clasificaci√≥n</p>
            </div>
          `;
          container.appendChild(logroCaidaLibre);
        }
        
        // 10. Mostrar logro "Estrella Fugaz" (m√°s medallas en un solo d√≠a)
        const fechasMedallas = JSON.parse(localStorage.getItem('medalDates') || '[]');
        
        // Contar medallas por participante y por d√≠a
        const medallasPorDia = {};
        
        fechasMedallas.forEach(medal => {
          if (!medal.date || !medal.participant) return;
          
          const key = `${medal.participant}-${medal.date}`;
          if (!medallasPorDia[key]) {
            medallasPorDia[key] = {
              participante: medal.participant,
              fecha: medal.date,
              cantidad: 0
            };
          }
          medallasPorDia[key].cantidad++;
        });
        
        // Encontrar el r√©cord de m√°s medallas en un d√≠a
        const records = Object.values(medallasPorDia);
        if (records.length > 0) {
          // Ordenar por cantidad de medallas (de mayor a menor)
          records.sort((a, b) => b.cantidad - a.cantidad);
          
          const maxMedallas = records[0].cantidad;
          const mejoresDias = records.filter(r => r.cantidad === maxMedallas);
          
          // Crear el elemento del logro
          const logroEstrellaFugaz = document.createElement('div');
          logroEstrellaFugaz.className = 'logro';
          logroEstrellaFugaz.setAttribute('data-emoji', '‚òÑÔ∏è');
          logroEstrellaFugaz.style.background = 'var(--logro-morado-fondo, #f3e5f5)';
          logroEstrellaFugaz.style.borderLeft = '4px solid var(--logro-morado-borde, #9c27b0)';
          
          // Formatear la fecha
          const fecha = new Date(mejoresDias[0].fecha);
          const fechaFormateada = fecha.toLocaleDateString('es-ES', {
            day: '2-digit',
            month: 'long',
            year: 'numeric'
          });
          
          // Obtener los nombres de los participantes con el mismo r√©cord
          const nombres = [...new Set(mejoresDias.map(d => d.participante))];
          const textoNombres = formatearNombres(nombres);
          
          logroEstrellaFugaz.innerHTML = `
            <div class="logro-icono">‚òÑÔ∏è</div>
            <div class="logro-contenido">
              <h3>Estrella Fugaz</h3>
              <p>${textoNombres} ${nombres.length > 1 ? 'han' : 'ha'} ganado ${maxMedallas} medallas en un solo d√≠a (${fechaFormateada})</p>
            </div>
          `;
          container.appendChild(logroEstrellaFugaz);
        }
        
        // 10. Mostrar logro "Rompecabezas" (Oro, Bronce, Plata en ese orden)
        const unlockedAchievements = JSON.parse(localStorage.getItem('unlockedAchievements') || '{}');
        const participantesConRompecabezas = [];
        
        // Buscar participantes que hayan desbloqueado el logro
        Object.entries(unlockedAchievements).forEach(([nombre, logros]) => {
          if (logros && logros.includes('puzzle')) {
            const participante = participantesConTotales.find(p => p.nombre === nombre);
            if (participante) {
              participantesConRompecabezas.push({
                nombre,
                oro: participante.oro || 0,
                plata: participante.plata || 0,
                bronce: participante.bronce || 0
              });
            }
          }
        });
        
        if (participantesConRompecabezas.length > 0) {
          const logroRompecabezas = document.createElement('div');
          logroRompecabezas.className = 'logro';
          logroRompecabezas.style.background = 'var(--logro-azul-fondo, #e3f2fd)';
          logroRompecabezas.style.borderLeft = '4px solid var(--logro-azul-borde, #2196f3)';
          
          const nombres = participantesConRompecabezas.map(p => p.nombre);
          const textoNombres = formatearNombres(nombres);
          
          logroRompecabezas.innerHTML = `
            <div class="logro-icono">üß©</div>
            <div class="logro-contenido">
              <h3>Rompecabezas</h3>
              <p>${textoNombres} ${nombres.length > 1 ? 'han' : 'ha'} completado el patr√≥n de medallas: Oro, Bronce, Plata</p>
            </div>
          `;
          container.appendChild(logroRompecabezas);
        }
        
        // 9. Mostrar logros "Estilo √önico" agrupados por tipo de medalla
        Object.entries(estiloUnico).forEach(([tipo, participantes]) => {
          if (participantes.length > 0) {
            const logroEstiloUnico = document.createElement('div');
            logroEstiloUnico.className = 'logro';
            logroEstiloUnico.style.background = 'var(--logro-morado-fondo)';
            logroEstiloUnico.style.borderLeft = '4px solid var(--logro-morado-borde)';
            
            const nombres = participantes.map(p => p.nombre);
            const textoNombres = formatearNombres(nombres);
            const total = participantes.reduce((sum, p) => sum + (p[tipo] || 0), 0);
            
            const icono = tipo === 'oro' ? 'ü•á' : (tipo === 'plata' ? 'ü•à' : 'ü•â');
            const textoMedalla = tipo === 'oro' ? 'oro' : (tipo === 'plata' ? 'plata' : 'bronce');
            const colorClase = tipo === 'oro' ? 'gold' : (tipo === 'plata' ? 'silver' : 'bronze');
            
            logroEstiloUnico.innerHTML = `
              <div class="logro-icono">üé©</div>
              <div class="logro-contenido">
                <h3>Estilo √önico - ${textoMedalla.charAt(0).toUpperCase() + textoMedalla.slice(1)}</h3>
                <p>${textoNombres} ${participantes.length > 1 ? 'se especializan' : 'se especializa'} en medallas de ${textoMedalla} (${total} en total)</p>
                <div class="participantes-ganadores">
                  ${participantes.map(p => `
                    <div class="participante">
                      <strong>${p.nombre}:</strong>
                      <span class="${colorClase}">${icono} ${p[tipo]} ${textoMedalla}</span>
                    </div>
                  `).join('')}
                </div>
              </div>
            `;
            container.appendChild(logroEstiloUnico);
          }
        });
        
        // Mostrar logro "Escalador Profesional" (m√°s posiciones subidas en total)
        if (mejorMejora.nombre && mejorMejora.mejoraTotal > 0) {
          const logroMejora = document.createElement('div');
          logroMejora.className = 'logro';
          logroMejora.style.background = 'var(--logro-verde-fondo)';
          logroMejora.style.borderLeft = '4px solid var(--logro-verde-borde)';
          
          let textoPosicion = '';
          if (mejorMejora.posicionActual > 0) {
            textoPosicion = ` (actualmente en el ${mejorMejora.posicionActual}¬∫ puesto)`;
          }
          
          logroMejora.innerHTML = `
            <div class="logro-icono">üßó</div>
            <div class="logro-contenido">
              <h3>Escalador Profesional</h3>
              <p>${mejorMejora.nombre} ha subido m√°s posiciones en total${textoPosicion}</p>
              <div class="participante">
                <strong>Total subidas:</strong>
                <span class="green">+${mejorMejora.mejoraTotal} posiciones</span>
              </div>
            </div>
          `;
          
          // Insertar despu√©s del Rey de la Monta√±a o al principio
          if (container.firstChild) {
            container.insertBefore(logroMejora, container.firstChild.nextSibling);
          } else {
            container.appendChild(logroMejora);
          }
        }
        
        // Mostrar logro "Rey de la Monta√±a" (l√≠der actual)
        if (reyMontana.length > 0) {
          const logroReyMontana = document.createElement('div');
          logroReyMontana.className = 'logro';
          logroReyMontana.style.background = 'var(--logro-oro-fondo)';
          logroReyMontana.style.borderLeft = '4px solid var(--logro-oro-borde)';
          
          if (reyMontana.length === 1) {
            const lider = reyMontana[0];
            logroReyMontana.innerHTML = `
              <div class="logro-icono">üèîÔ∏è</div>
              <div class="logro-contenido">
                <h3>Rey de la Monta√±a</h3>
                <p>${lider.nombre} lidera la clasificaci√≥n con ${lider.total} medallas en total</p>
                <div class="medal-count">
                  <span class="gold">ü•á ${lider.oro}</span>
                  <span class="silver">ü•à ${lider.plata}</span>
                  <span class="bronze">ü•â ${lider.bronce}</span>
                </div>
              </div>
            `;
          } else {
            const nombres = reyMontana.map(p => p.nombre);
            const textoNombres = formatearNombres(nombres);
            
            logroReyMontana.innerHTML = `
              <div class="logro-icono">üèîÔ∏è</div>
              <div class="logro-contenido">
                <h3>Reyes de la Monta√±a</h3>
                <p>${textoNombres} lideran la clasificaci√≥n con ${reyMontana[0].total} medallas cada uno</p>
                <div class="participantes-ganadores">
                  ${reyMontana.map(p => `
                    <div class="participante">
                      <strong>${p.nombre}:</strong>
                      <span class="gold">ü•á ${p.oro}</span>
                      <span class="silver">ü•à ${p.plata}</span>
                      <span class="bronze">ü•â ${p.bronce}</span>
                    </div>
                  `).join('')}
                </div>
              </div>
            `;
          }
          
          // Insertar al principio de la lista de logros
          if (container.firstChild) {
            container.insertBefore(logroReyMontana, container.firstChild);
          } else {
            container.appendChild(logroReyMontana);
          }
        }
        
        // Mostrar mensaje si no hay logros para mostrar
        if (container.children.length === 0) {
          container.innerHTML = `
            <div class="no-logros">
              <p>¬°A√∫n no hay suficientes datos para mostrar logros!</p>
              <p>Empieza a asignar medallas a los participantes para ver sus logros destacados.</p>
            </div>
          `;
        }
        
        // Mostrar datos de depuraci√≥n en consola
        console.log('=== DATOS DE DEPURACI√ìN ===');
        console.log('Participantes:', participantes);
        console.log('Medallas registradas:', medallas);
      }
      
      // Cargar logros al iniciar la p√°gina
      cargarLogrosDestacados();
      
      // Funci√≥n para cargar el historial reciente
      function cargarHistorialReciente(showAll = false) {
        const container = document.getElementById('recentHistoryContainer');
        if (!container) return;
        
        // Obtener el historial de medallas del localStorage con variables propias
        const medalDatesHistorial = JSON.parse(localStorage.getItem('medalDatesHistorial') || '[]');
        const medalDates = JSON.parse(localStorage.getItem('medalDates') || '[]');
        
        console.log('Datos de depuraci√≥n:');
        console.log('medalDatesHistorial:', medalDatesHistorial);
        console.log('medalDates:', medalDates);
        
        // Si no hay datos en la nueva variable, migrar los datos antiguos si existen
        if (medalDatesHistorial.length === 0 && medalDates.length > 0) {
          console.log('Migrando datos de medalDates a medalDatesHistorial');
          localStorage.setItem('medalDatesHistorial', JSON.stringify(medalDates));
          // No eliminamos el viejo para mantener compatibilidad
          return cargarHistorialReciente(showAll); // Recargar con los datos migrados
        }
        
        // Ordenar por fecha m√°s reciente primero
        const sortedHistory = [...medalDatesHistorial].sort((a, b) => b.timestamp - a.timestamp);
        
        if (sortedHistory.length === 0) {
          container.innerHTML = `
            <div class="no-history">
              <p>No hay eventos recientes</p>
              <p><small>Las medallas que se otorguen aparecer√°n aqu√≠</small></p>
            </div>`;
          return;
        }
        
        // Mostrar solo 5 elementos inicialmente, o todos si showAll es true
        const showMoreButton = sortedHistory.length > 5 && !showAll;
        const eventsToShow = showAll ? sortedHistory : sortedHistory.slice(0, 5);
        
        // Mapear los tipos de medalla a emojis y colores
        const medalInfo = {
          gold: { emoji: 'ü•á', color: '#FFD700' },
          silver: { emoji: 'ü•à', color: '#C0C0C0' },
          bronze: { emoji: 'ü•â', color: '#CD7F32' }
        };
        
        // Crear el HTML para cada evento
        const historyHTML = eventsToShow.map(event => {
          const medal = medalInfo[event.type] || { emoji: 'üèÖ', color: '#6c757d' };
          const date = new Date(parseInt(event.timestamp));
          const timeString = date.toLocaleTimeString('es-ES', { 
            hour: '2-digit', 
            minute: '2-digit',
            day: '2-digit',
            month: '2-digit',
            year: '2-digit'
          });
          
          return `
            <div class="history-item ${event.type}">
              <div class="history-icon" style="color: ${medal.color}">${medal.emoji}</div>
              <div class="history-details">
                <div class="history-title">
                  <span class="history-medal">${medal.emoji}</span>
                  ${event.participant} ha ganado ${getMedalName(event.type)}
                </div>
                <div class="history-time">${timeString}</div>
              </div>
            </div>`;
        }).join('');
        
        // A√±adir los botones de control de visualizaci√≥n
        if (showAll) {
          // Mostrar todo con bot√≥n "Mostrar menos"
          container.innerHTML = `
            <div class="history-items">
              ${historyHTML}
            </div>
            <div class="show-more-container">
              <button id="btnMostrarMenos" class="btn-show-more">
                <i class="fas fa-chevron-up"></i> Mostrar menos
              </button>
            </div>`;
            
          document.getElementById('btnMostrarMenos').addEventListener('click', () => {
            cargarHistorialReciente(false);
            // Desplazarse suavemente al inicio del historial
            container.scrollIntoView({ behavior: 'smooth', block: 'start' });
          });
            
        } else if (sortedHistory.length > 5) {
          // Mostrar solo 5 con bot√≥n "Mostrar m√°s"
          container.innerHTML = `
            <div class="history-items">
              ${historyHTML}
            </div>
            <div class="show-more-container">
              <button id="btnMostrarMas" class="btn-show-more">
                <i class="fas fa-chevron-down"></i> Mostrar m√°s (${sortedHistory.length - 5} m√°s)
              </button>
            </div>`;
            
          document.getElementById('btnMostrarMas').addEventListener('click', () => {
            cargarHistorialReciente(true);
          });
        } else {
          // Mostrar todo sin botones si hay 5 o menos elementos
          container.innerHTML = `
            <div class="history-items">
              ${historyHTML}
            </div>`;
        }
        
        // Funci√≥n auxiliar para obtener el nombre de la medalla
        function getMedalName(type) {
          const names = {
            gold: 'oro',
            silver: 'plata',
            bronze: 'bronce'
          };
          return names[type] || 'una medalla';
        }
      }
      
      // Cargar el historial reciente despu√©s de definir la funci√≥n
      cargarHistorialReciente();
      
      // Estilos para los botones de control
      const style = document.createElement('style');
      style.textContent = `
        .show-more-container {
          display: flex;
          justify-content: center;
          width: 100%;
          margin-top: 8px;
        }
        
        .btn-show-more {
          display: inline-flex;
          align-items: center;
          justify-content: center;
          gap: 6px;
          padding: 6px 12px;
          background: none;
          border: none;
          color: #0d6efd;
          font-weight: 500;
          cursor: pointer;
          transition: all 0.2s ease;
          border-radius: 4px;
          margin: 0;
        }
        
        .btn-show-more:hover {
          background: rgba(13, 110, 253, 0.1);
          transform: translateY(-1px);
        }
        
        .btn-show-more:active {
          transform: translateY(0);
          background: rgba(13, 110, 253, 0.15);
        }
        
        .btn-show-more i {
          font-size: 0.8em;
          transition: transform 0.2s ease;
        }
        
        .history-items {
          transition: all 0.3s ease;
        }
      `;
      document.head.appendChild(style);
      
      // Actualizar el historial cuando se reciba un evento de actualizaci√≥n
      window.addEventListener('storage', function(e) {
        if (e.key === 'medalDates') {
          cargarHistorialReciente();
        }
      });
    });
    </script>

</body>
</html>
